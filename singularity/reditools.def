Bootstrap: docker
From: ubuntu:20.04

%environment
    export PATH="/opt/miniconda/bin:$PATH" 
    source /opt/etc/bashrc

%runscript
    exec "$@"

%post
    ###### apt requisites
    apt update
    apt -y install git wget
    ###### building env
    # miniconda2: get miniconda2 latest vers
    wget https://repo.continuum.io/miniconda/Miniconda2-py27_4.8.3-Linux-x86_64.sh -O miniconda.sh
    # install conda
    bash miniconda.sh -b -p /opt/miniconda
    export PATH="/opt/miniconda/bin:$PATH"
    # create env
    mkdir -p /opt/etc
    conda create --name reditools
    echo -e "#! /bin/bash\n\n# script to activate the conda environment" > ~/.bashrc
    # init env so we can activate it
    conda init bash
    echo -e "\nconda activate reditools" >> ~/.bashrc
    conda clean -ay
    cp ~/.bashrc /opt/etc/bashrc
    ###### reditools source and install
    git clone https://github.com/BioinfoUNIBA/REDItools.git
    cd REDItools && python setup.py install
    # deps 
    conda install -y -c bioconda -c conda-forge pysam
